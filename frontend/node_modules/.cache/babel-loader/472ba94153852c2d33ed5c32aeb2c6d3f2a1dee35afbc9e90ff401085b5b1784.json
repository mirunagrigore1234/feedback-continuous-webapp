{"ast":null,"code":"const API = process.env.REACT_APP_API_URL || \"http://localhost:9001/api\";\nfunction authHeaders(extra = {}) {\n  const token = localStorage.getItem(\"token\");\n  return {\n    ...extra,\n    ...(token ? {\n      Authorization: `Bearer ${token}`\n    } : {})\n  };\n}\nasync function jsonFetch(url, options = {}) {\n  // cheia: prevenim 304/caching pentru live\n  const sep = url.includes(\"?\") ? \"&\" : \"?\";\n  const noCacheUrl = `${url}${sep}ts=${Date.now()}`;\n  const r = await fetch(noCacheUrl, {\n    cache: \"no-store\",\n    ...options\n  });\n\n  // încearcă să citești mesajul de eroare dacă există\n  if (!r.ok) {\n    const text = await r.text().catch(() => \"\");\n    throw new Error(text || `HTTP ${r.status}`);\n  }\n\n  // unele răspunsuri pot fi 204\n  const text = await r.text();\n  return text ? JSON.parse(text) : null;\n}\n\n// 1) ia activitatea după cod (ca să afli ActivityId)\nasync function getActivityByCode(accessCode) {\n  return jsonFetch(`${API}/activities/code/${encodeURIComponent(accessCode)}`);\n}\n\n// 2) trimite feedback\nasync function createFeedback({\n  ActivityId,\n  Emotion,\n  Comment\n}) {\n  // student anonim: ID local (persistă în browser)\n  let studentId = localStorage.getItem(\"anonStudentId\");\n  if (!studentId) {\n    studentId = String(Math.floor(Math.random() * 1000000000));\n    localStorage.setItem(\"anonStudentId\", studentId);\n  }\n  const payload = {\n    ActivityId,\n    StudentId: parseInt(studentId, 10),\n    Emotion\n  };\n  if (Comment && Comment.trim()) payload.Comment = Comment.trim();\n  return jsonFetch(`${API}/feedback`, {\n    method: \"POST\",\n    headers: authHeaders({\n      \"Content-Type\": \"application/json\"\n    }),\n    body: JSON.stringify(payload)\n  });\n}\n\n// helper: feedback direct by code\nasync function sendFeedbackByCode(accessCode, {\n  emotion,\n  comment\n}) {\n  var _activity$ActivityId;\n  const activity = await getActivityByCode(accessCode);\n  const activityId = (_activity$ActivityId = activity === null || activity === void 0 ? void 0 : activity.ActivityId) !== null && _activity$ActivityId !== void 0 ? _activity$ActivityId : activity === null || activity === void 0 ? void 0 : activity.id;\n  if (!activityId) throw new Error(\"ActivityId missing from server response\");\n  return createFeedback({\n    ActivityId: activityId,\n    Emotion: emotion,\n    Comment: comment\n  });\n}\n\n// 3) ia feedback-urile pe activitate (profesor / dashboard)\nasync function getFeedbacksByActivity(activityId) {\n  // ajustează ruta dacă la tine e altfel\n  return jsonFetch(`${API}/feedback/activity/${activityId}`, {\n    headers: authHeaders()\n  });\n}\nexport default {\n  getFeedbacksByActivity,\n  getActivityByCode,\n  createFeedback,\n  sendFeedbackByCode\n};","map":{"version":3,"names":["API","process","env","REACT_APP_API_URL","authHeaders","extra","token","localStorage","getItem","Authorization","jsonFetch","url","options","sep","includes","noCacheUrl","Date","now","r","fetch","cache","ok","text","catch","Error","status","JSON","parse","getActivityByCode","accessCode","encodeURIComponent","createFeedback","ActivityId","Emotion","Comment","studentId","String","Math","floor","random","setItem","payload","StudentId","parseInt","trim","method","headers","body","stringify","sendFeedbackByCode","emotion","comment","_activity$ActivityId","activity","activityId","id","getFeedbacksByActivity"],"sources":["D:/Anul III/TW/feedback-continuous-webapp/frontend/src/services/feedbackService.js"],"sourcesContent":["const API = process.env.REACT_APP_API_URL || \"http://localhost:9001/api\";\r\n\r\nfunction authHeaders(extra = {}) {\r\n  const token = localStorage.getItem(\"token\");\r\n  return {\r\n    ...extra,\r\n    ...(token ? { Authorization: `Bearer ${token}` } : {}),\r\n  };\r\n}\r\n\r\nasync function jsonFetch(url, options = {}) {\r\n  // cheia: prevenim 304/caching pentru live\r\n  const sep = url.includes(\"?\") ? \"&\" : \"?\";\r\n  const noCacheUrl = `${url}${sep}ts=${Date.now()}`;\r\n\r\n  const r = await fetch(noCacheUrl, {\r\n    cache: \"no-store\",\r\n    ...options,\r\n  });\r\n\r\n  // încearcă să citești mesajul de eroare dacă există\r\n  if (!r.ok) {\r\n    const text = await r.text().catch(() => \"\");\r\n    throw new Error(text || `HTTP ${r.status}`);\r\n  }\r\n\r\n  // unele răspunsuri pot fi 204\r\n  const text = await r.text();\r\n  return text ? JSON.parse(text) : null;\r\n}\r\n\r\n// 1) ia activitatea după cod (ca să afli ActivityId)\r\nasync function getActivityByCode(accessCode) {\r\n  return jsonFetch(`${API}/activities/code/${encodeURIComponent(accessCode)}`);\r\n}\r\n\r\n// 2) trimite feedback\r\nasync function createFeedback({ ActivityId, Emotion, Comment }) {\r\n  // student anonim: ID local (persistă în browser)\r\n  let studentId = localStorage.getItem(\"anonStudentId\");\r\n  if (!studentId) {\r\n    studentId = String(Math.floor(Math.random() * 1_000_000_000));\r\n    localStorage.setItem(\"anonStudentId\", studentId);\r\n  }\r\n\r\n  const payload = {\r\n    ActivityId,\r\n    StudentId: parseInt(studentId, 10),\r\n    Emotion,\r\n  };\r\n\r\n  if (Comment && Comment.trim()) payload.Comment = Comment.trim();\r\n\r\n  return jsonFetch(`${API}/feedback`, {\r\n    method: \"POST\",\r\n    headers: authHeaders({ \"Content-Type\": \"application/json\" }),\r\n    body: JSON.stringify(payload),\r\n  });\r\n}\r\n\r\n// helper: feedback direct by code\r\nasync function sendFeedbackByCode(accessCode, { emotion, comment }) {\r\n  const activity = await getActivityByCode(accessCode);\r\n  const activityId = activity?.ActivityId ?? activity?.id;\r\n  if (!activityId) throw new Error(\"ActivityId missing from server response\");\r\n  return createFeedback({ ActivityId: activityId, Emotion: emotion, Comment: comment });\r\n}\r\n\r\n// 3) ia feedback-urile pe activitate (profesor / dashboard)\r\nasync function getFeedbacksByActivity(activityId) {\r\n  // ajustează ruta dacă la tine e altfel\r\n  return jsonFetch(`${API}/feedback/activity/${activityId}`, {\r\n    headers: authHeaders(),\r\n  });\r\n}\r\n\r\nexport default {\r\n  getFeedbacksByActivity,\r\n  getActivityByCode,\r\n  createFeedback,\r\n  sendFeedbackByCode,\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}